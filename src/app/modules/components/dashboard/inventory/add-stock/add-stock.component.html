<p class="h1">Add Stock</p>

<div class="card-body mt-3">
  <form [formGroup]="stockForm" (ngSubmit)="onSubmit()">

    <!-- Supplier Input -->
    <div class="row mb-3">
      <div class="col-md-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Supplier</mat-label>
          <input matInput formControlName="supplier" placeholder="Enter supplier name">
          <mat-error *ngIf="stockForm.get('supplier')?.hasError('required')">
            Supplier is required
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <!-- Product Search Dropdown -->
    <div class="row mb-4">
      <div class="col-md-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Product Code + Name</mat-label>
          <input type="text" matInput formControlName="selectedProduct" [matAutocomplete]="auto"
            placeholder="Search products...">
          <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayProduct"
            (optionSelected)="onProductSelected($event.option.value)">
            <mat-option *ngFor="let option of filteredProducts | async" [value]="option.product">
              {{ option.display }}
            </mat-option>
          </mat-autocomplete>
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
      </div>
      <div class="col-md-6 d-flex align-items-center">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Price ($)</mat-label>
          <input matInput type="number" formControlName="costPricePerUnit" min="0" placeholder="Price">
        </mat-form-field>
      </div>

      <!-- Variants Section -->
      <div *ngIf="variants.length > 0" class="variants-section mb-4">
        <h4 class="mb-3">Product Variants</h4>
        <div class="table-responsive">
          <table class="table table-bordered">
            <thead class="table-light">
              <tr>
                <th>Variant</th>
                <th>Quantity</th>
              </tr>
            </thead>
            <tbody formArrayName="variants">
              <tr *ngFor="let variant of variants.controls; let i = index" [formGroupName]="i">
                <td>
                  {{ variant.get('variantName')?.value }}
                </td>
                <td>
                  <mat-form-field appearance="outline" class="w-100">
                    <input matInput type="number" formControlName="quantity" min="0" placeholder="Quantity">
                  </mat-form-field>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <!-- Totals Section -->
    <div class="row mb-3">
      <div class="col-md-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Total Quantity</mat-label>
          <input matInput formControlName="totalQuantity" [readonly]="true">
        </mat-form-field>
      </div>
      <div class="col-md-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Total Price ($)</mat-label>
          <input matInput formControlName="totalPrice" [readonly]="true">
        </mat-form-field>
      </div>
      <div class="col-md-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Discount ($)</mat-label>
          <input matInput type="number" formControlName="discount" min="0" step="0.01" (input)="calculateTotalCost()">
        </mat-form-field>
      </div>
      <div class="col-md-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Shipping Cost ($)</mat-label>
          <input matInput type="number" formControlName="shippingCost" min="0" step="0.01"
            (input)="calculateTotalCost()">
        </mat-form-field>
      </div>
    </div>

    <!-- Other Costs Section -->
    <div class="row mb-4">
      <div class="col-md-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Other Cost ($)</mat-label>
          <input matInput type="number" formControlName="otherCost" min="0" step="0.01" (input)="calculateTotalCost()"
            placeholder="Optional">
        </mat-form-field>
      </div>
      <div class="col-md-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Reason for Other Cost</mat-label>
          <input matInput formControlName="otherCostReason" placeholder="Enter reason (optional)">
        </mat-form-field>
      </div>
    </div>

    <!-- Total Cost -->
    <div class="row mb-4">
      <div class="col-md-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Total Cost ($)</mat-label>
          <input matInput formControlName="totalCost" [readonly]="true" class="total-cost-input">
        </mat-form-field>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="row">
      <div class="col-12">
        <button mat-raised-button color="primary" type="submit" [disabled]="!stockForm.valid" class="submit-btn">
          <mat-icon>save</mat-icon>
          Submit Stock
        </button>
      </div>
    </div>

  </form>
</div>